// Generated by CoffeeScript 1.8.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  app.AppCache = (function() {
    $.extend(AppCache.prototype, Events);

    AppCache.isEnabled = function() {
      try {
        return applicationCache && applicationCache.status !== applicationCache.UNCACHED;
      } catch (_error) {

      }
    };

    function AppCache() {
      this.onUpdateReady = __bind(this.onUpdateReady, this);
      this.onProgress = __bind(this.onProgress, this);
      this.checkForUpdate = __bind(this.checkForUpdate, this);
      this.cache = applicationCache;
      if (this.cache.status === this.cache.UPDATEREADY) {
        this.onUpdateReady();
      }
      $.on(this.cache, 'progress', this.onProgress);
      $.on(this.cache, 'updateready', this.onUpdateReady);
      this.lastCheck = Date.now();
      $.on(window, 'focus', this.checkForUpdate);
    }

    AppCache.prototype.update = function() {
      try {
        this.cache.update();
      } catch (_error) {

      }
    };

    AppCache.prototype.reload = function() {
      this.reloading = true;
      $.on(this.cache, 'updateready noupdate error', function() {
        return window.location = '/';
      });
      this.update();
    };

    AppCache.prototype.checkForUpdate = function() {
      if (Date.now() - this.lastCheck > 86400e3) {
        this.lastCheck = Date.now();
        this.update();
      }
    };

    AppCache.prototype.onProgress = function(event) {
      this.trigger('progress', event);
    };

    AppCache.prototype.onUpdateReady = function() {
      if (!this.reloading) {
        new app.views.Notif('UpdateReady', {
          autoHide: null
        });
      }
      this.trigger('updateready');
    };

    return AppCache;

  })();

}).call(this);
