// Generated by CoffeeScript 1.8.0
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  app.views.JqueryPage = (function(_super) {
    __extends(JqueryPage, _super);

    function JqueryPage() {
      this.onIframeLoaded = __bind(this.onIframeLoaded, this);
      return JqueryPage.__super__.constructor.apply(this, arguments);
    }

    JqueryPage.demoClassName = '_jquery-demo';

    JqueryPage.prototype.afterRender = function() {
      var el, iframe, language, _i, _j, _len, _len1, _ref, _ref1;
      _ref = this.findAllByTag('iframe');
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        iframe = _ref[_i];
        iframe.style.display = 'none';
        $.on(iframe, 'load', this.onIframeLoaded);
      }
      this.runExamples();
      _ref1 = this.findAllByClass('syntaxhighlighter');
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        el = _ref1[_j];
        language = el.classList.contains('javascript') ? 'javascript' : 'markup';
        this.highlightCode(el, language);
      }
    };

    JqueryPage.prototype.onIframeLoaded = function(event) {
      event.target.style.display = '';
      $.off(event.target, 'load', this.onIframeLoaded);
    };

    JqueryPage.prototype.runExamples = function() {
      var el, _i, _len, _ref;
      _ref = this.findAllByClass('entry-example');
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        el = _ref[_i];
        try {
          this.runExample(el);
        } catch (_error) {

        }
      }
    };

    JqueryPage.prototype.runExample = function(el) {
      var doc, iframe, source;
      source = el.getElementsByClassName('syntaxhighlighter')[0];
      if (!(source && source.innerHTML.indexOf('!doctype') !== -1)) {
        return;
      }
      if (!(iframe = el.getElementsByClassName(this.constructor.demoClassName)[0])) {
        iframe = document.createElement('iframe');
        iframe.className = this.constructor.demoClassName;
        iframe.width = '100%';
        iframe.height = 200;
        el.appendChild(iframe);
      }
      doc = iframe.contentDocument;
      doc.write(this.fixIframeSource(source.textContent));
      doc.close();
    };

    JqueryPage.prototype.fixIframeSource = function(source) {
      source = source.replace('"/resources/', '"http://api.jquery.com/resources/');
      return source.replace('</head>', "<style>\n  html, body { border: 0; margin: 0; padding: 0; }\n  body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; }\n</style>\n<script>\n  $.ajaxPrefilter(function(opt, opt2, xhr) {\n    if (opt.url.indexOf('http') !== 0) {\n      xhr.abort();\n      document.body.innerHTML = \"<p><strong>This demo cannot run inside DevDocs.</strong></p>\";\n    }\n  });\n</script>\n</head>");
    };

    return JqueryPage;

  })(app.views.BasePage);

}).call(this);
